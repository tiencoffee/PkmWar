(function(b,c){'object'==typeof module&&'object'==typeof exports?module.exports=c():'function'==typeof define&&define.amd?define([],c):b.httpVueLoader=c()})(this,function(){'use strict';function b(l,m){this.component=l,this.elt=m}function c(l,m){this.component=l,this.elt=m,this.module={exports:{}}}function d(l,m){this.component=l,this.elt=m}function e(l){this.name=l,this.template=null,this.script=null,this.styles=[],this._scopeId=''}function f(l){return l}function g(l){var m=l.match(/(.*?)([^/]+?)\/?(\.vue)?(\?.*|#.*|$)/);return{name:m[2],url:m[1]+m[2]+(void 0===m[3]?'/index.vue':m[3])+m[4]}}function h(l,m){return'./'===m.substr(0,2)||'../'===m.substr(0,3)?l+m:m}function j(l,m){var n=g(l);return j.load(n.url,m)}var k=0;return b.prototype={withBase:function(l){var m;if(this.component.baseURI){m=document.createElement('base'),m.href=this.component.baseURI;var n=this.component.getHead();n.insertBefore(m,n.firstChild)}l.call(this),m&&this.component.getHead().removeChild(m)},scopeStyles:function(l,m){function n(){for(var s,o=l.sheet,q=o.cssRules,r=0;r<q.length;++r)if(s=q[r],1===s.type){var t=[];s.selectorText.split(/\s*,\s*/).forEach(function(x){t.push(m+' '+x);var y=x.match(/([^ :]+)(.+)?/);t.push(y[1]+m+(y[2]||''))});var u=t.join(',')+s.cssText.substr(s.selectorText.length);o.deleteRule(r),o.insertRule(u,r)}}try{n()}catch(o){if(o instanceof DOMException&&o.code===DOMException.INVALID_ACCESS_ERR)return l.sheet.disabled=!0,void l.addEventListener('load',function q(){l.removeEventListener('load',q),setTimeout(function(){n(),l.sheet.disabled=!1})});throw o}},compile:function(){var l=null!==this.template,m=this.elt.hasAttribute('scoped');if(m){if(!l)return;this.elt.removeAttribute('scoped')}return this.withBase(function(){this.component.getHead().appendChild(this.elt)}),m&&this.scopeStyles(this.elt,'['+this.component.getScopeId()+']'),Promise.resolve()},getContent:function(){return this.elt.textContent},setContent:function(l){this.withBase(function(){this.elt.textContent=l})}},c.prototype={getContent:function(){return this.elt.textContent},setContent:function(l){this.elt.textContent=l},compile:function(){var m=function(r){return j.require(h(this.component.baseURI,r))}.bind(this),n=function(r,s){return j(h(this.component.baseURI,r),s)}.bind(this);try{Function('exports','require','httpVueLoader','module',this.getContent()).call(this.module.exports,this.module.exports,m,n,this.module)}catch(r){if(!('lineNumber'in r))return Promise.reject(r);var o=responseText.replace(/\r?\n/g,'\n'),q=o.substr(0,o.indexOf(script)).split('\n').length+r.lineNumber-1;throw new r.constructor(r.message,url,q)}return Promise.resolve(this.module.exports)}},d.prototype={getContent:function(){return this.elt.innerHTML},setContent:function(l){this.elt.innerHTML=l},getRootElt:function(){var l=this.elt.content||this.elt;if('firstElementChild'in l)return l.firstElementChild;for(l=l.firstChild;null!==l;l=l.nextSibling)if(l.nodeType===Node.ELEMENT_NODE)return l;return null},compile:function(){return Promise.resolve()}},e.prototype={getHead:function(){return document.head||document.getElementsByTagName('head')[0]},getScopeId:function(){return''===this._scopeId&&(this._scopeId='data-s-'+(k++).toString(36),this.template.getRootElt().setAttribute(this._scopeId,'')),this._scopeId},load:function(l){return j.httpRequest(l).then(function(m){this.baseURI=l.substr(0,l.lastIndexOf('/')+1);var n=document.implementation.createHTMLDocument('');n.body.innerHTML=(this.baseURI?'<base href="'+this.baseURI+'">':'')+m;for(var o=n.body.firstChild;o;o=o.nextSibling)switch(o.nodeName){case'TEMPLATE':this.template=new d(this,o);break;case'SCRIPT':this.script=new c(this,o);break;case'STYLE':this.styles.push(new b(this,o));}return this}.bind(this))},_normalizeSection:function(l){var m;return m=null!==l&&l.elt.hasAttribute('src')?j.httpRequest(l.elt.getAttribute('src')).then(function(n){return l.elt.removeAttribute('src'),n}):Promise.resolve(null),m.then(function(n){if(null!==l&&l.elt.hasAttribute('lang')){var o=l.elt.getAttribute('lang');return l.elt.removeAttribute('lang'),j.langProcessor[o.toLowerCase()](null===n?l.getContent():n)}return n}).then(function(n){null!==n&&l.setContent(n)})},normalize:function(){return Promise.all(Array.prototype.concat(this._normalizeSection(this.template),this._normalizeSection(this.script),this.styles.map(this._normalizeSection))).then(function(){return this}.bind(this))},compile:function(){return Promise.all(Array.prototype.concat(this.template&&this.template.compile(),this.script&&this.script.compile(),this.styles.map(function(l){return l.compile()}))).then(function(){return this}.bind(this))}},j.load=function(l,m){return function(){return new e(m).load(l).then(function(n){return n.normalize()}).then(function(n){return n.compile()}).then(function(n){var o=null===n.script?{}:n.script.module.exports;return null!==n.template&&(o.template=n.template.getContent()),void 0===o.name&&void 0!==n.name&&(o.name=n.name),o._baseURI=n.baseURI,o})}},j.register=function(l,m){var n=g(m);l.component(n.name,j.load(n.url))},j.install=function(l){l.mixin({beforeCreate:function(){var m=this.$options.components;for(var n in m)if('string'==typeof m[n]&&'url:'===m[n].substr(0,4)){var o=g(m[n].substr(4)),q='_baseURI'in this.$options?h(this.$options._baseURI,o.url):o.url;m[n]=isNaN(n)?j.load(q,n):l.component(o.name,j.load(q,o.name))}}})},j.require=function(l){return window[l]},j.httpRequest=function(l){return new Promise(function(m,n){var o=new XMLHttpRequest;o.open('GET',l),o.onreadystatechange=function(){4===o.readyState&&(200<=o.status&&300>o.status?m(o.responseText):n(o.status))},o.send(null)})},j.langProcessor={html:f,js:f,css:f},j}),Vue.use(httpVueLoader),httpVueLoader.langProcessor.pug=a=>pug.render(a.replace(/(^|\r?\n)\t/g,'$1'),{doctype:'html'}),httpVueLoader.langProcessor.stylus=a=>stylus.render(a),httpVueLoader.langProcessor.coffee=a=>CoffeeScript.compile(a,{bare:!0});